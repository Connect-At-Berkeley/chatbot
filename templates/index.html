<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Connect@Cal General Chatbot</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <!-- <link rel="stylesheet" src="static/styles/style.css"> -->
  <link rel="stylesheet" type= "text/css" href="{{ url_for('static', filename='styles/styles.css') }}">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@700&display=swap" rel="stylesheet">
  <!--script type="text/javascript" src="intents.json"></script-->
</head>

<body>
  <!-- partial:index.partial.html -->
  <section class="msger">
    <header class="msger-header">
      <div class="msger-header-title">
      <br>
      <h1 style="font-family: 'Quicksand', sans-serif;"> Connect@Cal General Cases Chatbot </h1>
      <br>
      </div>
    </header>

    <main class="msger-chat">
      <div class="msg left-msg">
        <div class="msg-img" style="background-image: url(https://i.ibb.co/TKjfK1y/Group-8.png)"></div>

        <div class="msg-bubble">
          <div class="msg-info">
            <div  class="msg-info-name">Connect@Cal</div>
          </div> 

          <div class="msg-text">
            <p>Hi! ðŸ‘‹ We're Connect@Cal, the one stop service to connect you to the most relevant resources, programs, and opportunities! </p>
            <br>
            <button onclick="sendMessage('I am ready to get connected!')" style="margin-left: 0px; border-radius: 5px; padding: 10px; font-family: 'Quicksand', sans-serif;" class="msger-send-btn"> I am ready to get connected!</button>
            <button onclick="printLinks('Links')" style="margin-left: 0px; border-radius: 5px; padding: 10px; font-family: 'Quicksand', sans-serif;" class="msger-send-btn"> Press for links</button>
          </div>

        </div>

      </div>

    </main>

    <form class="msger-inputarea">
      <input type="text" style="font-family: 'Quicksand', sans-serif; outline-color: #056BA5;" class="msger-input" id="textInput" placeholder="Please write a reply...">
      <button style="font-family: 'Quicksand', sans-serif;" type="submit" class="msger-send-btn">Send</button>
   
    </form>
  </section>
  <!-- partial -->
  <script src='https://use.fontawesome.com/releases/v5.0.13/js/all.js'></script>
  <script>
    
    
    const msgerForm = get(".msger-inputarea");
    const msgerInput = get(".msger-input");
    const msgerChat = get(".msger-chat");


   
    const BOT_IMG = "https://i.ibb.co/TKjfK1y/Group-8.png";
    const PERSON_IMG = "https://i.ibb.co/z7mrNQD/user-icon.png";
    const BOT_NAME = "Connect@Cal";
    const PERSON_NAME = "You";

    $.getJSON("../static/intents.json", function(data)
      {
        for (var i = 0; i<data["intents"].length; i++)
        {
          if(typeof data["intents"][i].links !== 'undefined'){
            console.log(data["intents"][i].links);
          }
        }
      });

    function printLinks(msg)
    {
      var finalMessage = "";
      /*const msgHTML = ` 
      <button onclick="sendMessage(${msg})" margin-left: 1000px; style=" border-radius: 5px; padding: 10px; font-family: 'Quicksand', sans-serif;" class="msger-send-btn"> Links </button>
      ` ;*/
      $.getJSON("../static/intents.json", function(data)
      {
        for (var i = 0; i<data["intents"].length; i++)
        {
          if(typeof data["intents"][i].links !== 'undefined'){
            for (var j = 0; j<data["intents"][i].links.length; j++)
            {
              finalMessage += "<a href = " + data["intents"][i].links[j] +">" + data["intents"][i].responses[j] +"</a>" + "<br>";
            }
            appendMessage(BOT_NAME, BOT_IMG, "left",finalMessage);
            break;
          }
        }
      });


    }
    function appendLinkMessage(name, img, side, text) {
      //   Simple solution for small apps
      

      const msgHTML = `
<div class="msg ${side}-msg">
  <div class="msg-img" style="background-image: url(${img})"></div>

  <div style="color:#056BA5; background-color:#F0F0F0;" class="msg-bubble">
    <div class="msg-info">
      <div class="msg-info-name">${name}</div>
      
    </div>

    <div class="msg-text">${text}</div>

  </div>
</div>
`;
    
    

      msgerChat.insertAdjacentHTML("beforeend", msgHTML);
      msgerChat.scrollTop += 500;
    }
    
    
    function sendMessage(message)
    {
      
      const msgText = message;
      appendMessage(PERSON_NAME, PERSON_IMG, "right", msgText);
      msgerInput.value = "";
      botResponse(msgText);
    }

    msgerForm.addEventListener("submit", event => {
    event.preventDefault();

    const msgText = msgerInput.value;
    if (!msgText) return;

    appendMessage(PERSON_NAME, PERSON_IMG, "right", msgText);
    msgerInput.value = "";
    botResponse(msgText);
  });

    
  function appendButton(msg, buttonName) {
      //   Simple solution for small apps
      const msgHTML = ` 
      <button onclick="sendMessage(${msg})" margin-left: 1000px; style=" border-radius: 5px; padding: 10px; font-family: 'Quicksand', sans-serif;" class="msger-send-btn"> ${buttonName}</button>
`;
      console.log("appended button")
    


      msgerChat.insertAdjacentHTML("beforeend", msgHTML);
      msgerChat.scrollTop += 500;
      console.log("appended button2")
    }

    function appendMessage(name, img, side, text) {
      //   Simple solution for small apps
      const msgHTML = `
<div class="msg ${side}-msg">
  <div class="msg-img" style="background-image: url(${img})"></div>

  <div style="color:#056BA5; background-color:#F0F0F0;" class="msg-bubble">
    <div class="msg-info">
      <div class="msg-info-name">${name}</div>
      
    </div>

    <div class="msg-text">${text}</div>

  </div>
</div>
`;
    
    

      msgerChat.insertAdjacentHTML("beforeend", msgHTML);
      msgerChat.scrollTop += 500;
    }
    
    /*function appendLinks(name, img, side, text) {
      //   Simple solution for small apps
      const msgHTML = `
<div class="msg ${side}-msg">
  <div class="msg-img" style="background-image: url(${img})"></div>

  <div style="color:#056BA5; background-color:#F0F0F0;" class="msg-bubble">
    <div class="msg-info">
      <div class="msg-info-name">${name}</div>
      
    </div>

    <div class="msg-text">${text}</div>
  </div>
</div>
`;
    


      msgerChat.insertAdjacentHTML("beforeend", msgHTML);
      msgerChat.scrollTop += 500;
    }*/
    function appendMessageChat(name, img, side, text) {
      //   Simple solution for small apps
      const msgHTML = `
<div class="msg ${side}-msg">
  <div class="msg-img" style="background-image: url(${img})"></div>

  <div style="color:black; background-color:white;" class="msg-bubble">
    <div class="msg-info">
      <div class="msg-info-name">${name}</div>
      
    </div>

    <div class="msg-text">${text}</div>
  </div>
</div>
`;
      msgerChat.insertAdjacentHTML("beforeend", msgHTML);
      msgerChat.scrollTop += 500;
    }

    function botResponse(rawText) {

      // Bot Response
      $.get("/get", { msg: rawText }).done(function (data) {
        console.log(rawText);
        console.log(data);
        const msgText = data;
        if (msgText == "Letâ€™s start with getting to know you a little bit better! Which group do you fall in? ðŸŽ“"){
          appendMessageChat(BOT_NAME, BOT_IMG, "left", msgText);
          appendButton("'help me please'", "Help Me");
          console.log("after append button")
          
        }
        else{
        
        appendMessageChat(BOT_NAME, BOT_IMG, "left", msgText);
        }
      });

    }
    


    // Utils
    function get(selector, root = document) {
      return root.querySelector(selector);
    }

    // function formatDate(date) {
    //   const h = "0" + date.getHours();
    //   const m = "0" + date.getMinutes();

    //   return `${h.slice(-2)}:${m.slice(-2)}`;
    // }



  </script>

</body>

</html>